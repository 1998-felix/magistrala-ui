<!-- Copyright (c) Abstract Machines
SPDX-License-Identifier: Apache-2.0 -->

{{ define "dynamicdatachartmodal" }}
  <!-- Modal -->
  <div
    class="modal fade"
    id="dynamicDataChartModal"
    tabindex="-1"
    role="dialog"
    aria-labelledby="dynamicDataChartModalLabel"
    aria-hidden="true"
  >
    <div class="modal-dialog modal-dialog-centered">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="dynamicDataChartModalLabel">Dynamic Data Chart</h5>
          <button
            type="button"
            class="btn-close"
            data-bs-dismiss="modal"
            aria-label="Close"
          ></button>
        </div>
        <div class="modal-body">
          <!-- Tab Navs -->
          <ul class="nav nav-tabs mb-3" id="chartTab" role="tablist">
            <li class="nav-item" role="presentation">
              <button
                class="nav-link active"
                id="data-tab"
                data-bs-toggle="tab"
                data-bs-target="#dynamicDataChartData"
                type="button"
                role="tab"
                aria-controls="data"
                aria-selected="true"
              >
                Data
              </button>
            </li>
            <li class="nav-item" role="presentation">
              <button
                class="nav-link"
                id="appearance-tab"
                data-bs-toggle="tab"
                data-bs-target="#dynamicDataChartAppearance"
                type="button"
                role="tab"
                aria-controls="appearance"
                aria-selected="false"
              >
                Appearance
              </button>
            </li>
          </ul>
          <!-- Tab Content -->
          <div class="tab-content" id="myTabContent">
            <!-- Data Tab -->
            <div
              class="tab-pane fade show active"
              id="dynamicDataChartData"
              role="tabpanel"
              aria-labelledby="data-tab"
            >
              <form id="create-dynamicDataChart-data-form">
                <div class="mb-3">
                  <label for="channel-id" class="form-label">Channel ID</label>
                  <input
                    type="text"
                    class="form-control mb-3"
                    name="channel"
                    id="channel-id"
                    placeholder="Enter the channel ID"
                    required
                  />
                </div>
                <div class="mb-3">
                  <label for="thing-id" class="form-label">Thing IDs</label>
                  <input
                    type="text"
                    class="form-control mb-3"
                    name="thing"
                    id="thing-id"
                    placeholder="Enter the thing IDs"
                    required
                  />
                </div>
                <div class="mb-3">
                  <label for="value-name" class="form-label">Value names</label>
                  <input
                    type="text"
                    class="form-control mb-3"
                    name="valueName"
                    id="value-name"
                    placeholder="Enter the value names eg. temperature, pressure"
                    required
                  />
                </div>
                <div class="mb-3">
                  <label for="y-axis-type" class="form-label">Y-axis Type</label>
                  <select class="form-select mb-3" name="yAxisType" id="y-axis-typr">
                    <option value="" disabled>Select y-axis Type</option>
                    <option value="value">Value</option>
                    <option value="category">Category</option>
                    <option value="time">Time</option>
                    <option value="log">Log</option>
                  </select>
                </div>
                <div class="mb-3">
                  <label for="start-time" class="form-label">Start time</label>
                  <input
                    type="datetime-local"
                    class="form-control mb-3"
                    name="startTime"
                    id="start-name"
                    placeholder="Enter the start time."
                    required
                  />
                </div>
                <div class="mb-3">
                  <label for="stop-time" class="form-label">Stop time</label>
                  <input
                    type="datetime-local"
                    class="form-control mb-3"
                    name="stopTime"
                    id="stop-name"
                    placeholder="Enter the stop time."
                  />
                </div>
                <div class="mb-3">
                  <label for="time-interval" class="form-label">Time interval</label>
                  <input
                    type="text"
                    class="form-control mb-3"
                    name="timeInterval"
                    id="time-interval"
                    placeholder="Enter the time interval in seconds"
                    required
                  />
                </div>
              </form>
            </div>
            <!-- Appearance Tab -->
            <div
              class="tab-pane fade"
              id="dynamicDataChartAppearance"
              role="tabpanel"
              aria-labelledby="appearance-tab"
            >
              <form id="create-dynamicDataChart-appearance-form">
                <div class="mb-3">
                  <label for="title" class="form-label">Title</label>
                  <input
                    type="text"
                    class="form-control"
                    name="title"
                    id="title"
                    placeholder="Enter the chart title"
                  />
                </div>
                <div class="mb-3">
                  <label for="x-axis-label" class="form-label">X axis label</label>
                  <input
                    type="text"
                    class="form-control mb-3"
                    name="xAxisLabel"
                    id="x-axis-label"
                    placeholder="Enter the x axis label"
                  />
                </div>
                <div class="mb-3">
                  <label for="line-y-axis-label" class="form-label">Line Y axis label</label>
                  <input
                    type="text"
                    class="form-control mb-3"
                    name="lineYAxisLabel"
                    id="line-y-axis-label"
                    placeholder="Enter the line chart y axis label"
                  />
                </div>
                <div class="mb-3">
                  <label for="bar-y-axis-label" class="form-label">Bar Y axis label</label>
                  <input
                    type="text"
                    class="form-control mb-3"
                    name="barYAxisLabel1"
                    id="bar-y-axis-label"
                    placeholder="Enter the bar chart y axis label"
                  />
                </div>
                <div class="mb-3">
                  <label for="series-name" class="form-label">Line data series name</label>
                  <input
                    type="text"
                    class="form-control mb-3"
                    name="lineDataSeriesName"
                    id="series-name"
                    placeholder="Enter the series name eg. temperature"
                    required
                  />
                </div>
                <div class="mb-3">
                  <label for="series-name" class="form-label">Bar data series name</label>
                  <input
                    type="text"
                    class="form-control mb-3"
                    name="barDataSeriesName"
                    id="series-name"
                    placeholder="Enter the series name eg. temperature"
                    required
                  />
                </div>
              </form>
            </div>
          </div>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
          <button
            type="button"
            class="btn body-button"
            id="create-dynamicDataChart-button"
            data-bs-dismiss="modal"
          >
            Create Chart
          </button>
        </div>
      </div>
    </div>
  </div>
  <script>
    // dynamic data chart form
    document
      .getElementById("create-dynamicDataChart-button")
      .addEventListener("click", function () {
        var form = document.getElementById("create-dynamicDataChart-appearance-form");
        // Create an object to store the form data
        var formData = {};

        // Serialize the form data into the object
        for (var i = 0; i < form.elements.length; i++) {
          var e = form.elements[i];
          if (e.type !== "submit" && e.type !== "button") {
            formData[e.name] = e.value;
          }
        }
        form.reset();

        var widgetID = "dynamicDatachart-" + Date.now();
        var widgetScript = `
          var dynamicDataChart = echarts.init(document.getElementById("${widgetID}"));
          var app = {};
          var categories = (function () {
              let now = new Date();
              let res = [];
              let len = 10;
              while (len--) {
                  res.unshift(now.toLocaleTimeString().replace(/^\D*/, ''));
                  now = new Date(+now - 2000);
              }
              return res;
          })();
          var categories2 = (function () {
              let res = [];
              let len = 10;
              while (len--) {
                  res.push(10 - len - 1);
              }
              return res;
          })();
          var data = (function () {
              
              let res = [];
              let len = 10;
              while (len--) {
                  res.push(Math.round(Math.random() * 1000));
              }
              return res;
          })();
          var data2 = (function () {
              let res = [];
              let len = 0;
              while (len < 10) {
                  res.push(+(Math.random() * 10 + 5).toFixed(1));
                  len++;
              }
              return res;
          })();
          var option = {
              title: {
                  text: 'Dynamic Data'
              },
              tooltip: {
                  trigger: 'axis',
                  axisPointer: {
                          type: 'cross',
                      label: {
                          backgroundColor: '#283b56'
                      }
              }
              },
              legend: {},
              toolbox: {
                  show: true,
              feature: {
                  dataView: { readOnly: false },
                  restore: {},
                  saveAsImage: {}
              }
              },
              dataZoom: {
                  show: false,
                  start: 0,
                  end: 100
              },
              xAxis: [
                  {
                      type: 'category',
                      boundaryGap: true,
                      data: categories,
                      name: '${formData.xAxisLabel}',
                      nameLocation: 'middle',
                      nameGap: 35
                  },
                  {
                      type: 'category',
                      boundaryGap: true,
                      data: categories2
                  }
              ],
              yAxis: [
                  {
                      type: 'value',
                      scale: true,
                      name: '${formData.lineYAxisLabel}',
                      nameLocation: 'middle',
                      nameGap: '35',
                      max: 30,
                      min: 0,
                      boundaryGap: [0.2, 0.2]
                  },
                  {
                      type: 'value',
                      scale: true,
                      name: '${formData.barYAxisLabel1}',
                      nameLocation: 'middle',
                      nameGap: '35',
                      max: 1200,
                      min: 0,
                      boundaryGap: [0.2, 0.2]
                  }
              ],
              series: [
                  {
                      name: '${formData.barDataSeriesName}',
                      type: 'bar',
                      xAxisIndex: 1,
                      yAxisIndex: 1,
                      data: data
                  },
                  {
                      name: '${formData.lineDataSeriesName}',
                      type: 'line',
                      data: data2
                  }
              ]
          };
          app.count = 11;
          setInterval(function () {
              let axisData = new Date().toLocaleTimeString().replace(/^\D*/, '');
              data.shift();
              data.push(Math.round(Math.random() * 1000));
              data2.shift();
              data2.push(+(Math.random() * 10 + 5).toFixed(1));
              categories.shift();
              categories.push(axisData);
              categories2.shift();
              categories2.push(app.count++);
              dynamicDataChart.setOption({
                  xAxis: [
                      {
                          data: categories
                      },
                      {
                          data: categories2
                      }
                  ],
                  series: [
                      {
                          data: data
                      },
                      {
                          data: data2
                      }
                  ]
              });
          }, 2100);

          dynamicDataChart.setOption(option);
        `;

      var config = {
        ID: widgetID,
        Script: widgetScript,
      }
      addWidget(config);
      });
  </script>
{{ end }}
